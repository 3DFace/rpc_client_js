{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///rpc_client.js","webpack:///webpack/bootstrap 7ef898f039853d6fd6b5","webpack:///./src/AjaxLayer.js","webpack:///./src/HookLayer.js","webpack:///./src/JsonLayer.js","webpack:///./src/LogLayer.js","webpack:///./src/ProtocolLayer.js","webpack:///./src/RpcClient.js","webpack:///./src/BatchLayer.js","webpack:///./src/index.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","e","i","l","call","m","c","p","s","AjaxLayer","url","send","request_str","Promise","resolve","reject","xhr","XMLHttpRequest","open","withCredentials","onload","status","response","statusText","onerror","HookLayer","protocol_layer","pre_fn","post_fn","calls","promises","JsonLayer","text_transport_layer","request","json","JSON","stringify","then","json_response","parse","name","message","LogLayer","log_request_fn","log_response_fn","log_error_fn","length","join","new_promises","Array","error","logger","extractResult","undefined","ProtocolLayer","json_layer","id","callbacks","formed_calls","service","method","parameters","push","result","r","RpcClient","client","params","batch","callback","batchLayer","__WEBPACK_IMPORTED_MODULE_0__BatchLayer__","batchClient","flush","BatchLayer","layer","calls_acc","callbacks_acc","concat","__WEBPACK_IMPORTED_MODULE_0__AjaxLayer__","__WEBPACK_IMPORTED_MODULE_1__LogLayer__","__WEBPACK_IMPORTED_MODULE_2__JsonLayer__","__WEBPACK_IMPORTED_MODULE_3__HookLayer__","__WEBPACK_IMPORTED_MODULE_4__ProtocolLayer__","__WEBPACK_IMPORTED_MODULE_5__RpcClient__","Object","prototype","hasOwnProperty","defineProperty","configurable","enumerable","get"],"mappings":"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","file":"rpc_client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"rpc_client\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rpc_client\"] = factory();\n\telse\n\t\troot[\"rpc_client\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"rpc_client\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rpc_client\"] = factory();\n\telse\n\t\troot[\"rpc_client\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].e;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\te: {},\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.e, module, module.e, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.e;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 7);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t/**\n\t * @param {string} url RPC-server URL\n\t * @constructor\n\t */\n\tfunction AjaxLayer(url){\n\t\n\t\tthis.send = function(request_str){\n\t\n\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\txhr.open(\"POST\", url, true);\n\t\t\t\txhr.withCredentials = true;\n\t\n\t\t\t\txhr.onload = function(){\n\t\t\t\t\tif(this.status >= 200 && this.status < 300){\n\t\t\t\t\t\tresolve(xhr.response);\n\t\t\t\t\t}else{\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\t\tstatusText: xhr.statusText\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\n\t\t\t\txhr.onerror = function(){\n\t\t\t\t\treject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tstatusText: xhr.statusText\n\t\t\t\t\t});\n\t\t\t\t};\n\t\n\t\t\t\txhr.send(request_str);\n\t\t\t});\n\t\n\t\t}\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = AjaxLayer;\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t/**\n\t * @param protocol_layer\n\t * @param {function} pre_fn\n\t * @param {function} post_fn\n\t * @constructor\n\t */\n\tfunction HookLayer(protocol_layer, pre_fn, post_fn){\n\t\tthis.send = function(calls){\n\t\t\tcalls = pre_fn ? pre_fn(calls) : calls;\n\t\t\tvar promises = protocol_layer.send(calls);\n\t\t\treturn post_fn ? post_fn(promises) : promises;\n\t\t}\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = HookLayer;\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t/**\n\t * @param {object} text_transport_layer\n\t * @constructor\n\t */\n\tfunction JsonLayer(text_transport_layer){\n\t\n\t\tthis.send = function(request){\n\t\n\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\ttry{\n\t\t\t\t\tvar json = JSON.stringify(request);\n\t\n\t\t\t\t\ttext_transport_layer.send(json).then(function(json_response){\n\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\tvar response = JSON.parse(json_response);\n\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\treject({\n\t\t\t\t\t\t\t\tname: \"JsonLayerError\",\n\t\t\t\t\t\t\t\tmessage: e.name + \": \" + e.message + \"\\n\" + json_response\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}, reject);\n\t\t\t\t}catch(e){\n\t\t\t\t\treject({\n\t\t\t\t\t\tname: \"JsonLayerError\",\n\t\t\t\t\t\tmessage: e.name + \": \" + e.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = JsonLayer;\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t/**\n\t * @param {object} protocol_layer\n\t * @param {function} log_request_fn\n\t * @param {function} log_response_fn\n\t * @param {function} log_error_fn\n\t * @constructor\n\t */\n\tfunction LogLayer(protocol_layer, log_request_fn, log_response_fn, log_error_fn){\n\t\n\t\tthis.send = function(calls){\n\t\n\t\t\tvar i, call;\n\t\t\tif(log_request_fn){\n\t\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\t\tcall = calls[i];\n\t\t\t\t\tlog_request_fn(\"call[\" + i + \"]\", call[0] + '->' + call[1] + '(' + (call[2] && call[2].join(', ') || '') + ')');\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\tvar promises = protocol_layer.send(calls);\n\t\n\t\t\tif(log_response_fn || log_error_fn){\n\t\t\t\tvar new_promises = new Array(promises.length);\n\t\t\t\tfor(i = 0; i < promises.length; i++){\n\t\t\t\t\t(function(i){\n\t\t\t\t\t\tnew_promises[i] = promises[i].then(function(response){\n\t\t\t\t\t\t\tlog_response_fn && log_response_fn(\"result[\" + i + \"]\", response);\n\t\t\t\t\t\t\treturn response;\n\t\t\t\t\t\t}, function(error){\n\t\t\t\t\t\t\tvar logger = log_error_fn || log_response_fn;\n\t\t\t\t\t\t\tlogger && logger(\"error[\" + i + \"]\", error);\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t})\n\t\t\t\t\t})(i);\n\t\t\t\t}\n\t\t\t\treturn new_promises;\n\t\t\t}else{\n\t\t\t\treturn promises;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = LogLayer;\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\tfunction extractResult(response){\n\t\tif(typeof response !== \"object\"){\n\t\t\tthrow {name: \"RpcProtocolError\", message: \"Bad response format: object expected, got \" + (typeof response)};\n\t\t}\n\t\tif(response[\"status\"] === undefined){\n\t\t\tthrow {name: \"RpcProtocolError\", message: \"no status\"};\n\t\t}\n\t\tif(response[\"result\"] === undefined){\n\t\t\tthrow {name: \"RpcProtocolError\", message: \"no result\"};\n\t\t}\n\t\tif(!response[\"status\"]){\n\t\t\tthrow {name: response[\"result\"][\"type\"] || \"UnknownError\", message: response[\"result\"][\"message\"] || \"\"};\n\t\t}\n\t\treturn response[\"result\"];\n\t}\n\t\n\t/**\n\t * @param {object} json_layer\n\t * @constructor\n\t */\n\tfunction ProtocolLayer(json_layer){\n\t\n\t\tvar id = 1;\n\t\n\t\tthis.send = function(calls){\n\t\n\t\t\tvar i, call;\n\t\t\tvar promises = new Array(calls.length);\n\t\t\tvar callbacks = [];\n\t\t\tif(calls.length > 0){\n\t\n\t\t\t\tvar formed_calls = new Array(calls.length);\n\t\n\t\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\t\tcall = calls[i];\n\t\t\t\t\tformed_calls[i] = {\n\t\t\t\t\t\tservice: call[0],\n\t\t\t\t\t\tmethod: call[1]\n\t\t\t\t\t};\n\t\t\t\t\tif(call[2] && call[2].length > 0){\n\t\t\t\t\t\tformed_calls[i].parameters = call[2];\n\t\t\t\t\t}\n\t\t\t\t\tpromises[i] = new Promise(function(resolve, reject){\n\t\t\t\t\t\tcallbacks.push([resolve, reject]);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\n\t\t\t\tvar request = {\n\t\t\t\t\tid: id++,\n\t\t\t\t\tcalls: formed_calls\n\t\t\t\t};\n\t\n\t\t\t\tjson_layer.send(request).then(function(response){\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvar result = extractResult(response);\n\t\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\t\tvar r = extractResult(result[i]);\n\t\t\t\t\t\t\t\tcallbacks[i][0](r);\n\t\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}catch(e){\n\t\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function(e){\n\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn promises;\n\t\t}\n\t\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = ProtocolLayer;\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__BatchLayer__ = __webpack_require__(6);\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t\n\t\n\t/**\n\t * @param {object} protocol_layer\n\t * @constructor\n\t */\n\tfunction RpcClient(protocol_layer){\n\t\n\t\tvar client = this;\n\t\n\t\tclient.call = function(service, method, params){\n\t\t\treturn protocol_layer.send([[service, method, params]])[0];\n\t\t};\n\t\n\t\tclient.batch = function(callback){\n\t\t\tvar batchLayer = new /* harmony import */__WEBPACK_IMPORTED_MODULE_0__BatchLayer__[\"a\"]();\n\t\t\tvar batchClient = new RpcClient(batchLayer);\n\t\t\tcallback(batchClient);\n\t\t\treturn batchLayer.flush(protocol_layer);\n\t\t};\n\t\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = RpcClient;\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t/**\n\t * @constructor\n\t */\n\tfunction BatchLayer(){\n\t\n\t\tvar layer = this;\n\t\tvar i, calls_acc = [], callbacks_acc = [];\n\t\n\t\tlayer.send = function(calls){\n\t\t\tvar promises = new Array(calls.length);\n\t\t\tcalls_acc = calls_acc.concat(calls);\n\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\tpromises[i] = new Promise(function(resolve, reject){\n\t\t\t\t\tcallbacks_acc.push([resolve, reject]);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn promises;\n\t\t};\n\t\n\t\tlayer.flush = function(protocol_layer){\n\t\t\tvar promises = protocol_layer.send(calls_acc);\n\t\t\tvar new_promises = new Array(promises.length);\n\t\t\tfor(var i = 0; i < callbacks_acc.length; i++){\n\t\t\t\tnew_promises[i] = promises[i].then(callbacks_acc[i][0], callbacks_acc[1]);\n\t\t\t}\n\t\t\treturn new_promises;\n\t\t};\n\t\n\t}\n\t\n\t/* harmony default export */ exports[\"a\"] = BatchLayer;\n\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__AjaxLayer__ = __webpack_require__(0);\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__LogLayer__ = __webpack_require__(3);\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__JsonLayer__ = __webpack_require__(2);\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__HookLayer__ = __webpack_require__(1);\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__ProtocolLayer__ = __webpack_require__(4);\n\t/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__RpcClient__ = __webpack_require__(5);\n\t/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t/* harmony reexport */ if(Object.prototype.hasOwnProperty.call(__WEBPACK_IMPORTED_MODULE_5__RpcClient__, \"a\")) Object.defineProperty(exports, \"RpcClient\", {configurable: false, enumerable: true, get: function() { return __WEBPACK_IMPORTED_MODULE_5__RpcClient__[\"a\"]; }});\n\t/* harmony reexport */ if(Object.prototype.hasOwnProperty.call(__WEBPACK_IMPORTED_MODULE_0__AjaxLayer__, \"a\")) Object.defineProperty(exports, \"AjaxLayer\", {configurable: false, enumerable: true, get: function() { return __WEBPACK_IMPORTED_MODULE_0__AjaxLayer__[\"a\"]; }});\n\t/* harmony reexport */ if(Object.prototype.hasOwnProperty.call(__WEBPACK_IMPORTED_MODULE_1__LogLayer__, \"a\")) Object.defineProperty(exports, \"LogLayer\", {configurable: false, enumerable: true, get: function() { return __WEBPACK_IMPORTED_MODULE_1__LogLayer__[\"a\"]; }});\n\t/* harmony reexport */ if(Object.prototype.hasOwnProperty.call(__WEBPACK_IMPORTED_MODULE_2__JsonLayer__, \"a\")) Object.defineProperty(exports, \"JsonLayer\", {configurable: false, enumerable: true, get: function() { return __WEBPACK_IMPORTED_MODULE_2__JsonLayer__[\"a\"]; }});\n\t/* harmony reexport */ if(Object.prototype.hasOwnProperty.call(__WEBPACK_IMPORTED_MODULE_3__HookLayer__, \"a\")) Object.defineProperty(exports, \"HookLayer\", {configurable: false, enumerable: true, get: function() { return __WEBPACK_IMPORTED_MODULE_3__HookLayer__[\"a\"]; }});\n\t/* harmony reexport */ if(Object.prototype.hasOwnProperty.call(__WEBPACK_IMPORTED_MODULE_4__ProtocolLayer__, \"a\")) Object.defineProperty(exports, \"ProtocolLayer\", {configurable: false, enumerable: true, get: function() { return __WEBPACK_IMPORTED_MODULE_4__ProtocolLayer__[\"a\"]; }});\n\t\n\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** rpc_client.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].e;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\te: {},\n \t\t\ti: moduleId,\n \t\t\tl: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.e, module, module.e, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.e;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 7ef898f039853d6fd6b5\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\n/**\n * @param {string} url RPC-server URL\n * @constructor\n */\nfunction AjaxLayer(url){\n\n\tthis.send = function(request_str){\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\txhr.open(\"POST\", url, true);\n\t\t\txhr.withCredentials = true;\n\n\t\t\txhr.onload = function(){\n\t\t\t\tif(this.status >= 200 && this.status < 300){\n\t\t\t\t\tresolve(xhr.response);\n\t\t\t\t}else{\n\t\t\t\t\treject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tstatusText: xhr.statusText\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.onerror = function(){\n\t\t\t\treject({\n\t\t\t\t\tstatus: this.status,\n\t\t\t\t\tstatusText: xhr.statusText\n\t\t\t\t});\n\t\t\t};\n\n\t\t\txhr.send(request_str);\n\t\t});\n\n\t}\n}\n\nexport default AjaxLayer;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/AjaxLayer.js\n ** module id = 0\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\n/**\n * @param protocol_layer\n * @param {function} pre_fn\n * @param {function} post_fn\n * @constructor\n */\nfunction HookLayer(protocol_layer, pre_fn, post_fn){\n\tthis.send = function(calls){\n\t\tcalls = pre_fn ? pre_fn(calls) : calls;\n\t\tvar promises = protocol_layer.send(calls);\n\t\treturn post_fn ? post_fn(promises) : promises;\n\t}\n}\n\nexport default HookLayer;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/HookLayer.js\n ** module id = 1\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\n/**\n * @param {object} text_transport_layer\n * @constructor\n */\nfunction JsonLayer(text_transport_layer){\n\n\tthis.send = function(request){\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\ttry{\n\t\t\t\tvar json = JSON.stringify(request);\n\n\t\t\t\ttext_transport_layer.send(json).then(function(json_response){\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvar response = JSON.parse(json_response);\n\t\t\t\t\t}catch(e){\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tname: \"JsonLayerError\",\n\t\t\t\t\t\t\tmessage: e.name + \": \" + e.message + \"\\n\" + json_response\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve(response);\n\t\t\t\t}, reject);\n\t\t\t}catch(e){\n\t\t\t\treject({\n\t\t\t\t\tname: \"JsonLayerError\",\n\t\t\t\t\tmessage: e.name + \": \" + e.message\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport default JsonLayer;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/JsonLayer.js\n ** module id = 2\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\n/**\n * @param {object} protocol_layer\n * @param {function} log_request_fn\n * @param {function} log_response_fn\n * @param {function} log_error_fn\n * @constructor\n */\nfunction LogLayer(protocol_layer, log_request_fn, log_response_fn, log_error_fn){\n\n\tthis.send = function(calls){\n\n\t\tvar i, call;\n\t\tif(log_request_fn){\n\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\tcall = calls[i];\n\t\t\t\tlog_request_fn(\"call[\" + i + \"]\", call[0] + '->' + call[1] + '(' + (call[2] && call[2].join(', ') || '') + ')');\n\t\t\t}\n\t\t}\n\n\t\tvar promises = protocol_layer.send(calls);\n\n\t\tif(log_response_fn || log_error_fn){\n\t\t\tvar new_promises = new Array(promises.length);\n\t\t\tfor(i = 0; i < promises.length; i++){\n\t\t\t\t(function(i){\n\t\t\t\t\tnew_promises[i] = promises[i].then(function(response){\n\t\t\t\t\t\tlog_response_fn && log_response_fn(\"result[\" + i + \"]\", response);\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t}, function(error){\n\t\t\t\t\t\tvar logger = log_error_fn || log_response_fn;\n\t\t\t\t\t\tlogger && logger(\"error[\" + i + \"]\", error);\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t})\n\t\t\t\t})(i);\n\t\t\t}\n\t\t\treturn new_promises;\n\t\t}else{\n\t\t\treturn promises;\n\t\t}\n\t}\n}\n\nexport  default LogLayer;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/LogLayer.js\n ** module id = 3\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\nfunction extractResult(response){\n\tif(typeof response !== \"object\"){\n\t\tthrow {name: \"RpcProtocolError\", message: \"Bad response format: object expected, got \" + (typeof response)};\n\t}\n\tif(response[\"status\"] === undefined){\n\t\tthrow {name: \"RpcProtocolError\", message: \"no status\"};\n\t}\n\tif(response[\"result\"] === undefined){\n\t\tthrow {name: \"RpcProtocolError\", message: \"no result\"};\n\t}\n\tif(!response[\"status\"]){\n\t\tthrow {name: response[\"result\"][\"type\"] || \"UnknownError\", message: response[\"result\"][\"message\"] || \"\"};\n\t}\n\treturn response[\"result\"];\n}\n\n/**\n * @param {object} json_layer\n * @constructor\n */\nfunction ProtocolLayer(json_layer){\n\n\tvar id = 1;\n\n\tthis.send = function(calls){\n\n\t\tvar i, call;\n\t\tvar promises = new Array(calls.length);\n\t\tvar callbacks = [];\n\t\tif(calls.length > 0){\n\n\t\t\tvar formed_calls = new Array(calls.length);\n\n\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\tcall = calls[i];\n\t\t\t\tformed_calls[i] = {\n\t\t\t\t\tservice: call[0],\n\t\t\t\t\tmethod: call[1]\n\t\t\t\t};\n\t\t\t\tif(call[2] && call[2].length > 0){\n\t\t\t\t\tformed_calls[i].parameters = call[2];\n\t\t\t\t}\n\t\t\t\tpromises[i] = new Promise(function(resolve, reject){\n\t\t\t\t\tcallbacks.push([resolve, reject]);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar request = {\n\t\t\t\tid: id++,\n\t\t\t\tcalls: formed_calls\n\t\t\t};\n\n\t\t\tjson_layer.send(request).then(function(response){\n\t\t\t\ttry{\n\t\t\t\t\tvar result = extractResult(response);\n\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\tvar r = extractResult(result[i]);\n\t\t\t\t\t\t\tcallbacks[i][0](r);\n\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}catch(e){\n\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, function(e){\n\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn promises;\n\t}\n\n}\n\nexport default ProtocolLayer;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/ProtocolLayer.js\n ** module id = 4\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\nimport BatchLayer from \"./BatchLayer\";\n\n/**\n * @param {object} protocol_layer\n * @constructor\n */\nfunction RpcClient(protocol_layer){\n\n\tvar client = this;\n\n\tclient.call = function(service, method, params){\n\t\treturn protocol_layer.send([[service, method, params]])[0];\n\t};\n\n\tclient.batch = function(callback){\n\t\tvar batchLayer = new BatchLayer();\n\t\tvar batchClient = new RpcClient(batchLayer);\n\t\tcallback(batchClient);\n\t\treturn batchLayer.flush(protocol_layer);\n\t};\n\n}\n\nexport default RpcClient;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/RpcClient.js\n ** module id = 5\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\n/**\n * @constructor\n */\nfunction BatchLayer(){\n\n\tvar layer = this;\n\tvar i, calls_acc = [], callbacks_acc = [];\n\n\tlayer.send = function(calls){\n\t\tvar promises = new Array(calls.length);\n\t\tcalls_acc = calls_acc.concat(calls);\n\t\tfor(i = 0; i < calls.length; i++){\n\t\t\tpromises[i] = new Promise(function(resolve, reject){\n\t\t\t\tcallbacks_acc.push([resolve, reject]);\n\t\t\t});\n\t\t}\n\t\treturn promises;\n\t};\n\n\tlayer.flush = function(protocol_layer){\n\t\tvar promises = protocol_layer.send(calls_acc);\n\t\tvar new_promises = new Array(promises.length);\n\t\tfor(var i = 0; i < callbacks_acc.length; i++){\n\t\t\tnew_promises[i] = promises[i].then(callbacks_acc[i][0], callbacks_acc[1]);\n\t\t}\n\t\treturn new_promises;\n\t};\n\n}\n\nexport default BatchLayer;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/BatchLayer.js\n ** module id = 6\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\nimport AjaxLayer from \"./AjaxLayer\";\nimport LogLayer from \"./LogLayer\";\nimport JsonLayer from \"./JsonLayer\";\nimport HookLayer from \"./HookLayer\";\nimport ProtocolLayer from \"./ProtocolLayer\";\nimport RpcClient from \"./RpcClient\";\n\nexport {AjaxLayer, LogLayer, JsonLayer, HookLayer, ProtocolLayer, RpcClient};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/index.js\n ** module id = 7\n ** module chunks = 0\n **/"],"sourceRoot":""}