{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 9542804b8020345dc2fd","webpack:///external \"promise\"","webpack:///./src/AjaxLayer.js","webpack:///./src/HookLayer.js","webpack:///./src/JsonLayer.js","webpack:///./src/LogLayer.js","webpack:///./src/ProtocolLayer.js","webpack:///./src/RpcClient.js","webpack:///./src/BatchLayer.js","webpack:///./src/index.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAS;AACT;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA,0C;;;;;;ACAA;;AAEA;;AAEA;;AAEA;AACA,aAAY,OAAO;AACnB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAM;AACN;;AAEA;AACA,KAAI;;AAEJ;AACA;;AAEA;AACA,EAAC;;;;;;;AC5CD;;AAEA;;AAEA;AACA;AACA,aAAY,SAAS;AACrB,aAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAC;;;;;;;ACnBD;;AAEA;;AAEA;;AAEA;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA,SAAQ;AACR;AACA;AACA,OAAM;AACN,MAAK;AACL;AACA;AACA;AACA,OAAM;AACN;AACA,KAAI;AACJ;AACA;;AAEA;;AAEA,EAAC;;;;;;;AC1CD;;AAEA;;AAEA;;AAEA;AACA,aAAY,OAAO;AACnB,aAAY,SAAS;AACrB,aAAY,SAAS;AACrB,aAAY,SAAS;AACrB;AACA;AACA;;AAEA;;AAEA;AACA;AACA,eAAc,kBAAkB;AAChC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,eAAc,qBAAqB;AACnC;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA,QAAO;AACP,OAAM;AACN;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;;AAEA,EAAC;;;;;;;AClDD;;AAEA;;AAEA;;AAEA;AACA;AACA,WAAU;AACV;AACA;AACA,WAAU;AACV;AACA;AACA,WAAU;AACV;AACA;AACA,WAAU;AACV;AACA;AACA;;AAEA;AACA,aAAY,OAAO;AACnB;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,eAAc,kBAAkB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAgB,sBAAsB;AACtC;AACA;AACA;AACA,SAAQ;AACR;AACA;AACA;AACA,OAAM;AACN,iBAAgB,sBAAsB;AACtC;AACA;AACA;AACA,MAAK;AACL,gBAAe,sBAAsB;AACrC;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAC;;;;;;;ACvFD;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAC;;;;;;;AC7BD;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,cAAa,kBAAkB;AAC/B;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAiB,0BAA0B;AAC3C;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAC;;;;;;;;;;;;;;;;;;;;;;ACtCD;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AACQ","file":"rpc_client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"promise\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"rpc_client\", [\"promise\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rpc_client\"] = factory(require(\"promise\"));\n\telse\n\t\troot[\"rpc_client\"] = factory(root[\"promise\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].e;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\te: {},\n \t\t\ti: moduleId,\n \t\t\tl: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.e, module, module.e, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.e;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 9542804b8020345dc2fd\n **/","module.e = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"promise\"\n ** module id = 0\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(require){\n\n\tvar Promise = require('promise');\n\n\t/**\n\t * @param {string} url RPC-server URL\n\t * @constructor\n\t */\n\tfunction AjaxLayer(url){\n\n\t\tthis.send = function(request){\n\n\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\txhr.open(\"POST\", url, true);\n\t\t\t\txhr.withCredentials = true;\n\n\t\t\t\txhr.onload = function(){\n\t\t\t\t\tif(this.status >= 200 && this.status < 300){\n\t\t\t\t\t\tresolve(xhr.response);\n\t\t\t\t\t}else{\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\t\tstatusText: xhr.statusText\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\txhr.onerror = function(){\n\t\t\t\t\treject({\n\t\t\t\t\t\tstatus: this.status,\n\t\t\t\t\t\tstatusText: xhr.statusText\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\txhr.send(request);\n\t\t\t});\n\n\t\t}\n\t}\n\n\treturn AjaxLayer;\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/AjaxLayer.js\n ** module id = 1\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(){\n\n\t/**\n\t * @param protocol_layer\n\t * @param {function} pre_fn\n\t * @param {function} post_fn\n\t * @constructor\n\t */\n\tfunction HookLayer(protocol_layer, pre_fn, post_fn){\n\t\tthis.send = function(calls){\n\t\t\tcalls = pre_fn ? pre_fn(calls) : calls;\n\t\t\tvar promises = protocol_layer.send(calls);\n\t\t\treturn post_fn ? post_fn(promises) : promises;\n\t\t}\n\t}\n\treturn HookLayer;\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/HookLayer.js\n ** module id = 2\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(require){\n\n\tvar Promise = require('promise');\n\n\t/**\n\t *\n\t * @param {object} under_layer\n\t * @constructor\n\t */\n\tfunction JsonLayer(under_layer){\n\n\t\tthis.send = function(request){\n\n\t\t\treturn new Promise(function(resolve, reject){\n\t\t\t\ttry{\n\t\t\t\t\tvar json = JSON.stringify(request);\n\n\t\t\t\t\tunder_layer.send(json).then(function(json_response){\n\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\tvar response = JSON.parse(json_response);\n\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\treject({\n\t\t\t\t\t\t\t\tname: \"JsonLayerError\",\n\t\t\t\t\t\t\t\tmessage: e.name + \": \" + e.message + \"\\n\" + json_response\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}, reject);\n\t\t\t\t}catch(e){\n\t\t\t\t\treject({\n\t\t\t\t\t\tname: \"JsonLayerError\",\n\t\t\t\t\t\tmessage: e.name + \": \" + e.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\treturn JsonLayer;\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/JsonLayer.js\n ** module id = 3\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(require){\n\n\tvar Promise = require('promise');\n\n\t/**\n\t * @param {object} under_layer\n\t * @param {function} log_request_fn\n\t * @param {function} log_response_fn\n\t * @param {function} log_error_fn\n\t * @constructor\n\t */\n\tfunction LogLayer(under_layer, log_request_fn, log_response_fn, log_error_fn){\n\n\t\tthis.send = function(calls){\n\n\t\t\tvar i, call;\n\t\t\tif(log_request_fn){\n\t\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\t\tcall = calls[i];\n\t\t\t\t\tlog_request_fn(\"call[\" + i + \"]\", call[0] + '->' + call[1] + '(' + (call[2] && call[2].join(', ') || '') + ')');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar promises = under_layer.send(calls);\n\n\t\t\tif(log_response_fn || log_error_fn){\n\t\t\t\tvar new_promises = new Array(promises.length);\n\t\t\t\tfor(i = 0; i < promises.length; i++){\n\t\t\t\t\t(function(i){\n\t\t\t\t\t\tnew_promises[i] = promises[i].then(function(response){\n\t\t\t\t\t\t\tlog_response_fn && log_response_fn(\"result[\" + i + \"]\", response);\n\t\t\t\t\t\t\treturn response;\n\t\t\t\t\t\t}, function(error){\n\t\t\t\t\t\t\tvar logger = log_error_fn || log_response_fn;\n\t\t\t\t\t\t\tlogger && logger(\"error[\" + i + \"]\", error);\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t})\n\t\t\t\t\t})(i);\n\t\t\t\t}\n\t\t\t\treturn new_promises;\n\t\t\t}else{\n\t\t\t\treturn promises;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn LogLayer;\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/LogLayer.js\n ** module id = 4\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(require){\n\n\tvar Promise = require('promise');\n\n\tfunction extractResult(response){\n\t\tif(typeof response !== \"object\"){\n\t\t\tthrow {name: \"RpcProtocolError\", message: \"Bad response format: object expected, got \" + (typeof response)};\n\t\t}\n\t\tif(response[\"status\"] === undefined){\n\t\t\tthrow {name: \"RpcProtocolError\", message: \"no status\"};\n\t\t}\n\t\tif(response[\"result\"] === undefined){\n\t\t\tthrow {name: \"RpcProtocolError\", message: \"no result\"};\n\t\t}\n\t\tif(!response[\"status\"]){\n\t\t\tthrow {name: response[\"result\"][\"type\"] || \"UnknownError\", message: response[\"result\"][\"message\"] || \"\"};\n\t\t}\n\t\treturn response[\"result\"];\n\t}\n\n\t/**\n\t * @param {object} under_layer\n\t * @constructor\n\t */\n\tfunction ProtocolLayer(under_layer){\n\n\t\tvar id = 1;\n\n\t\tthis.send = function(calls){\n\n\t\t\tvar i, call;\n\t\t\tvar promises = new Array(calls.length);\n\t\t\tvar callbacks = [];\n\t\t\tif(calls.length > 0){\n\n\t\t\t\tvar formed_calls = new Array(calls.length);\n\n\t\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\t\tcall = calls[i];\n\t\t\t\t\tformed_calls[i] = {\n\t\t\t\t\t\tservice: call[0],\n\t\t\t\t\t\tmethod: call[1]\n\t\t\t\t\t};\n\t\t\t\t\tif(call[2] && call[2].length > 0){\n\t\t\t\t\t\tformed_calls[i].parameters = call[2];\n\t\t\t\t\t}\n\t\t\t\t\tpromises[i] = new Promise(function(resolve, reject){\n\t\t\t\t\t\tcallbacks.push([resolve, reject]);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar request = {\n\t\t\t\t\tid: id++,\n\t\t\t\t\tcalls: formed_calls\n\t\t\t\t};\n\n\t\t\t\tunder_layer.send(request).then(function(response){\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvar result = extractResult(response);\n\t\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\t\tvar r = extractResult(result[i]);\n\t\t\t\t\t\t\t\tcallbacks[i][0](r);\n\t\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}catch(e){\n\t\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function(e){\n\t\t\t\t\tfor(i = 0; i < callbacks.length; i++){\n\t\t\t\t\t\tcallbacks[i][1](e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn promises;\n\t\t}\n\n\t}\n\n\treturn ProtocolLayer;\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/ProtocolLayer.js\n ** module id = 5\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(require){\n\n\tvar BatchLayer = require('./BatchLayer');\n\n\t/**\n\t * @param protocol_layer\n\t * @constructor\n\t */\n\tfunction RpcClient(protocol_layer){\n\n\t\tvar client = this;\n\n\t\tclient.call = function(service, method, params){\n\t\t\treturn protocol_layer.send([[service, method, params]])[0];\n\t\t};\n\n\t\tclient.batch = function(callback){\n\t\t\tvar batchLayer = new BatchLayer();\n\t\t\tvar batchClient = new RpcClient(batchLayer);\n\t\t\tcallback(batchClient);\n\t\t\treturn batchLayer.flush(protocol_layer);\n\t\t};\n\n\t}\n\n\treturn RpcClient;\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/RpcClient.js\n ** module id = 6\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\n\ndefine(function(require){\n\n\tvar Promise = require('promise');\n\n\t/**\n\t * @constructor\n\t */\n\tfunction BatchLayer(){\n\n\t\tvar layer = this;\n\t\tvar i, calls_acc = [], callbacks_acc = [];\n\n\t\tlayer.send = function(calls){\n\t\t\tvar promises = new Array(calls.length);\n\t\t\tcalls_acc = calls_acc.concat(calls);\n\t\t\tfor(i = 0; i < calls.length; i++){\n\t\t\t\tpromises[i] = new Promise(function(resolve, reject){\n\t\t\t\t\tcallbacks_acc.push([resolve, reject]);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn promises;\n\t\t};\n\n\t\tlayer.flush = function(protocol_layer){\n\t\t\tvar promises = protocol_layer.send(calls_acc);\n\t\t\tvar new_promises = new Array(promises.length);\n\t\t\tfor(var i = 0; i < callbacks_acc.length; i++){\n\t\t\t\tnew_promises[i] = promises[i].then(callbacks_acc[i][0], callbacks_acc[1]);\n\t\t\t}\n\t\t\treturn new_promises;\n\t\t};\n\n\t}\n\n\treturn BatchLayer;\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/BatchLayer.js\n ** module id = 7\n ** module chunks = 0\n **/","/* author: Ponomarev Denis <ponomarev@gmail.com> */\nimport AjaxLayer from \"./AjaxLayer\";\nimport LogLayer from \"./LogLayer\";\nimport JsonLayer from \"./JsonLayer\";\nimport HookLayer from \"./HookLayer\";\nimport ProtocolLayer from \"./ProtocolLayer\";\nimport RpcClient from \"./RpcClient\";\nexport {AjaxLayer, LogLayer, JsonLayer, HookLayer, ProtocolLayer, RpcClient};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/index.js\n ** module id = 8\n ** module chunks = 0\n **/"],"sourceRoot":""}